openapi: 3.0.3

info:
  title: Tinkoff Investments Tracking administrative API
  description: Tracking admin API
  contact:
    name: Vyacheslav Klapatnyuk
    email: v.klapatnyuk@tinkoff.ru
  version: 1.11.0

servers:
  - url: http://invest-qa.tinkoff.ru/tracking/admin/v1/
    description: тестовый стенд
  - url: http://trading.tinkoff.local
    description: боевой стенд

tags:
  - name: client
    description: Клиент
  - name: strategy
    description: Торговая стратегия
  - name: exchange-position
    description: Торговая позиция на бирже
  - name: contract
    description: Договор клиента
  - name: signal
    description: Торговый сигнал
  - name: timeline
    description: Лента событий

paths:

  /client/{clientId}/master/confirm:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    post:
      tags:
        - client
      summary: confirmMasterClient
      description: Подтверждает право участия клиента {clientId} в роли master
      operationId: confirmMasterClient
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/ClientId'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

  /client/master:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    get:
      tags:
        - client
      summary: getMasterClients
      description: Возвращает список клиентов, участвующих в автоследовании в роли master
      operationId: getMasterClients
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/Cursor'
        - $ref: '#/components/parameters/Limit'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetMasterClientsResponse'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        500:
          $ref: '#/components/responses/Error'

  /strategy/{strategyId}:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/StrategyId'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    get:
      tags:
        - strategy
      summary: getStrategy
      description: Возвращает торговую стратегию {strategyId}
      operationId: getStrategy
      security:
        - apiKey: []
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetStrategyResponse'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

    patch:
      tags:
        - strategy
      summary: updateStrategy
      description: Обновляет торговую стратегию {strategyId}
      operationId: updateStrategy
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/Login'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateStrategyRequest'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateStrategyResponse'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

  /strategy/{strategyId}/status/active:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    post:
      tags:
        - strategy
      summary: activateStrategy
      description: Активирует торговую стратегию {strategyId}
      operationId: activateStrategy
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/StrategyId'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

  /strategy:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    get:
      tags:
        - strategy
      summary: getStrategies
      description: Возвращает список торговых стратегий
      operationId: getStrategies
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/Cursor'
        - $ref: '#/components/parameters/Limit'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetStrategiesResponse'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        500:
          $ref: '#/components/responses/Error'

  /exchange-position:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    post:
      tags:
        - exchange-position
      summary: createExchangePosition
      description: Создаёт торговую биржевую позицию
      operationId: createExchangePosition
      security:
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateExchangePositionRequest'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateExchangePositionResponse'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

    patch:
      tags:
        - exchange-position
      summary: updateExchangePosition
      description: Обновляет торговую биржевую позицию
      operationId: updateExchangePosition
      security:
        - apiKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateExchangePositionRequest'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateExchangePositionResponse'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

    get:
      tags:
        - exchange-position
      summary: getExchangePositions
      description: Возвращает торговые биржевые позиции, добавленные в автоследование
      operationId: getExchangePositions
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/Cursor'
        - $ref: '#/components/parameters/Limit'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetExchangePositionsResponse'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        500:
          $ref: '#/components/responses/Error'

  /contract/{contractId}/block:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    post:
      tags:
        - contract
      summary: blockContract
      description: Создаёт техническую блокировку на договоре {contractId} клиента
      operationId: blockContract
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/ContractId'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

  /contract/{contractId}/synchronization/enable:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    post:
      tags:
        - contract
      summary: enableContractSynchronization
      description: Включить синхронизацию позиций в портфеле ведомого {contractId} в обе стороны
      operationId: enableContractSynchronization
      security:
        - apiKey: [ ]
      parameters:
        - $ref: '#/components/parameters/ContractId'
      responses:
        202:
          description: Accepted
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

  /contract/{contractId}/unblock:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    post:
      tags:
        - contract
      summary: unblockContract
      description: Запустить снятие технической блокировки с договора {contractId} клиента
      operationId: unblockContract
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/ContractId'
      responses:
        202:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

  /strategy/{strategyId}/signal:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    get:
      tags:
        - signal
      summary: getSignals
      description: Возвращает список сигналов в рамках торговой стратегии {strategyId}
      operationId: getSignals
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/StrategyId'
        - $ref: '#/components/parameters/Cursor'
        - $ref: '#/components/parameters/Limit'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetSignalsResponse'
        400:
          $ref: '#/components/responses/Error'
        401:
          $ref: '#/components/responses/Error'
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

  /contract/blocked:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    get:
      tags:
        - contract
      summary: getBlockedContracts
      description: Возвращает договоры, на которые наложена техническая блокировка
      operationId: getBlockedContracts
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/Cursor'
        - $ref: '#/components/parameters/Limit'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetBlockedContractsResponse'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        500:
          $ref: '#/components/responses/Error'

  /timeline:

    parameters:
      - $ref: '#/components/parameters/ApplicationName'
      - $ref: '#/components/parameters/ApplicationVersion'
      - $ref: '#/components/parameters/Platform'
      - $ref: '#/components/parameters/DeviceId'
      - $ref: '#/components/parameters/Login'
      - $ref: '#/components/parameters/B3TraceId'
      - $ref: '#/components/parameters/B3SpanId'
      - $ref: '#/components/parameters/B3ParentSpanId'
      - $ref: '#/components/parameters/B3Sampled'

    post:
      tags:
        - timeline
      summary: getTimeline
      description: Возвращает ленту событий с изменениями master-сущностей и slave-сущностей (опционально)
      operationId: getTimeline
      security:
        - apiKey: []
      parameters:
        - $ref: '#/components/parameters/Cursor'
        - $ref: '#/components/parameters/Limit'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetTimelineRequest'
      responses:
        200:
          description: OK
          headers:
            x-trace-id:
              $ref: '#/components/headers/XTraceId'
            x-server-time:
              $ref: '#/components/headers/XServerTime'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetTimelineResponse'
        400:
          $ref: '#/components/responses/Error'
        401:
          description: Unauthorized
        422:
          $ref: '#/components/responses/Error'
        500:
          $ref: '#/components/responses/Error'

components:

  securitySchemes:

    apiKey:
      type: apiKey
      in: header
      name: X-API-KEY

  headers:

    XTraceId:
      description: Идентификатор ответа
      schema:
        type: string
        minLength: 1
      required: true

    XServerTime:
      description: Метка времени формирования ответа
      schema:
        type: string
        format: date-time
      required: true

  parameters:

    ApplicationName:
      description: Название вызывающего приложения
      name: x-app-name
      in: header
      required: true
      schema:
        type: string
        minLength: 1
      example: investing

    ApplicationVersion:
      description: Версия вызывающего приложения
      name: x-app-version
      in: header
      required: false
      schema:
        type: string
        minLength: 1
      example: 5.0.0

    Platform:
      description: 'Платформа: "ios", "android", другое'
      name: x-platform
      in: header
      required: false
      schema:
        type: string
        minLength: 1
      example: android

    DeviceId:
      description: Идентификатор устройства
      name: x-device-id
      in: header
      required: false
      schema:
        type: string
        minLength: 1

    Login:
      name: x-tcs-login
      in: header
      required: true
      description: Логин авторизованного пользователя
      schema:
        type: string
        minLength: 1
        maxLength: 20
      example: v.klapatnyuk

    ClientId:
      description: Единый идентификатор клиента
      name: clientId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      example: 397aee00-f163-4eff-a7a6-a4bc11118776

    StrategyId:
      description: Идентификатор торговой стратегии
      name: strategyId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      example: 397aee00-f163-4eff-a7a6-a4bc11118776

    Cursor:
      name: cursor
      description: Идентификатор элемента, с которого начинать выдачу результатов при формировании ответа
      in: query
      required: false
      schema:
        type: string
        minLength: 1

    Limit:
      name: limit
      description: Ограничение "сверху" на количество возвращаемых элементов данных
      in: query
      required: false
      schema:
        type: integer
        minimum: 1

    B3TraceId:
      description: Общий идентификатор трассировки
      name: x-b3-traceid
      in: header
      required: false
      schema:
        type: string
        pattern: '^[a-f0-9]{16}$|^[a-f0-9]{32}$'
      example: 5b23a9529c0f48bc5b23a9529c0f48bc

    B3SpanId:
      description: Позиция текущей операции в общем дереве трассировки
      name: x-b3-spanid
      in: header
      required: false
      schema:
        type: string
        pattern: '^[a-f0-9]{16}$'
      example: a2fb4a1d1a96d312

    B3ParentSpanId:
      description: Позиция родительской операции в общем дереве трассировки
      name: x-b3-parentspanid
      in: header
      required: false
      schema:
        type: string
        pattern: '^[a-f0-9]{16}$'
      example: a2fb4a1d1a96d312

    B3Sampled:
      description: Сэмплинг
      name: x-b3-sampled
      in: header
      required: false
      schema:
        type: integer
        minimum: 0
        maximum: 1
      example: 1

    ContractId:
      description: Номер договора
      name: contractId
      in: path
      required: true
      schema:
        type: string
        minLength: 1
        maxLength: 10
      example: 2000000000

  responses:

    Error:
      description: Error
      headers:
        x-trace-id:
          $ref: '#/components/headers/XTraceId'
        x-server-time:
          $ref: '#/components/headers/XServerTime'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:

    CreateExchangePositionRequest:
      allOf:
        - $ref: '#/components/schemas/ExchangePosition'

    CreateExchangePositionResponse:
      allOf:
        - $ref: '#/components/schemas/ExchangePosition'

    UpdateExchangePositionRequest:
      allOf:
        - $ref: '#/components/schemas/ExchangePosition'

    UpdateExchangePositionResponse:
      allOf:
        - $ref: '#/components/schemas/ExchangePosition'

    ExchangePosition:
      description: Биржевая позиция
      allOf:
        - $ref: '#/components/schemas/ExchangePositionId'
        - type: object
          required:
            - exchange
            - trackingAllowed
            - orderQuantityLimits
          properties:
            exchange:
              description: Биржа (торговая площадка)
              type: string
              enum: [MOEX, MOEX_PLUS, FX, SPB]
            trackingAllowed:
              description: Признак разрешённой для торговли в автоследовании позиции
              type: boolean
            dailyQuantityLimit:
              description: Лимит кол-ва единиц актива в рамках одной торговой сессии (суммарно на master и его slave-портфели)
              type: integer
              minimum: 1
            orderQuantityLimits:
              description: Лимиты кол-ва единиц актива в рамках одной заявки (суммарно на master и его slave-портфели)
              type: array
              items:
                $ref: '#/components/schemas/OrderQuantityLimit'
              minItems: 1
            otcTicker:
              description: Тикер вне биржи (например, сплитованные валюты)
              type: string
              minLength: 1
              maxLength: 12
              example: USDRUB
            otcClassCode:
              description: Код класса инструмента вне биржи (например, сплитованные валюты)
              type: string
              minLength: 1
              maxLength: 10
              example: EES_CETS

    ExchangePositionId:
      description: Идентификатор биржевой позиции
      type: object
      required:
        - ticker
        - tradingClearingAccount
      properties:
        ticker:
          description: Тикер на бирже
          type: string
          minLength: 1
          maxLength: 12
          example: TCS
        tradingClearingAccount:
          description: Торгово-клиринговый счёт
          type: string
          minLength: 1
          maxLength: 12
          example: L01+00002F00

    OrderQuantityLimit:
      type: object
      required:
        - periodId
        - limit
      properties:
        periodId:
          description: Идентификатор периода
          type: string
          minLength: 1
          example: additional_liquidity
        limit:
          description: Лимит кол-ва единиц актива
          type: integer
          minimum: 0

    UpdateStrategyRequest:
      type: object
      properties:
        title:
          description: Название стратегии
          type: string
          minLength: 1
          nullable: true
          example: Ракета
        description:
          description: Описание стратегии
          type: string
          minLength: 1
          nullable: true
          example: Пушка
        score:
          description: Оценка стратегии
          type: integer
          minimum: 1
          maximum: 5
          nullable: true
        tests:
          description: Список тестирований, прохождение которых необходимо для следования за стратегией
          type: array
          items:
            $ref: '#/components/schemas/StrategyTest'
        feeRate:
          $ref: '#/components/schemas/NullableStrategyFeeRate'
        isOverloaded:
          description: Признак перегруженности стратегии
          type: boolean
        expectedRelativeYield:
          description: Ожидаемая относительная доходность стратегии (в процентах)
          type: number
          format: decimal
          nullable: true
        shortDescription:
          description: Короткое описание стратегии
          type: string
          minLength: 1
          nullable: true
          example: Получение доходности в валюте
        owner:
          description: Владелец стратегии
          type: object
          properties:
            description:
              description: Описание владельца стратегии
              type: string
              minLength: 1
              nullable: true
              example: 15 лет опыта, инвест. советник

    StrategyTest:
      description: Тестирование
      type: object
      required:
        - id
      properties:
        id:
          description: Идентификатор тестирования
          type: string
          minLength: 1
          example: foreign_shares

    NullableStrategyFeeRate:
      description: Ставка комиссии (в долях) за следование за стратегией
      type: object
      required:
        - management
        - result
      properties:
        management:
          description: Ставка комиссии за управление
          type: number
          format: decimal
          minimum: 0
          maximum: 1
          exclusiveMinimum: true
        result:
          description: Ставка комиссии за результат
          type: number
          format: decimal
          minimum: 0
          maximum: 1
          exclusiveMinimum: true
      nullable: true

    UpdateStrategyResponse:
      allOf:
        - $ref: '#/components/schemas/Strategy'

    GetStrategyResponse:
      allOf:
        - $ref: '#/components/schemas/Strategy'

    GetExchangePositionsResponse:
      type: object
      required:
        - nextCursor
        - hasNext
        - items
      properties:
        nextCursor:
          description: Крайний возвращённый в текущем ответе идентификатор элемента, который необходимо использовать при следующем запросе
          type: string
          minLength: 1
          nullable: true
        hasNext:
          description: Признак наличия элементов, не вошедших в текущий ответ
          type: boolean
        items:
          type: array
          items:
            $ref: '#/components/schemas/ExchangePosition'

    GetMasterClientsResponse:
      type: object
      required:
        - nextCursor
        - hasNext
        - items
      properties:
        nextCursor:
          description: Крайний возвращённый в текущем ответе идентификатор элемента, который необходимо использовать при следующем запросе
          type: string
          minLength: 1
          nullable: true
        hasNext:
          description: Признак наличия элементов, не вошедших в текущий ответ
          type: boolean
        items:
          type: array
          items:
            $ref: '#/components/schemas/MasterClient'

    MasterClient:
      description: Клиент в роли master
      type: object
      required:
        - id
        - status
      properties:
        id:
          $ref: '#/components/schemas/ClientId'
        status:
          description: Статус клиента
          type: string
          enum: [confirmed, registered]
        socialProfile:
          $ref: '#/components/schemas/MasterSocialProfile'

    MasterSocialProfile:
      description: Социальный профиль ведущего в Пульсе
      type: object
      required:
        - nickname
      properties:
        nickname:
          description: Никнейм профиля
          type: string
          minLength: 1

    GetStrategiesResponse:
      type: object
      required:
        - nextCursor
        - hasNext
        - items
      properties:
        nextCursor:
          description: Крайний возвращённый в текущем ответе идентификатор элемента, который необходимо использовать при следующем запросе
          type: string
          minLength: 1
          nullable: true
        hasNext:
          description: Признак наличия элементов, не вошедших в текущий ответ
          type: boolean
        items:
          type: array
          items:
            $ref: '#/components/schemas/StrategyPreview'

    Strategy:
      description: Торговая стратегия
      type: object
      required:
        - id
        - status
        - title
        - baseCurrency
        - riskProfile
        - description
        - owner
        - tests
        - load
      properties:
        id:
          $ref: '#/components/schemas/StrategyId'
        status:
          $ref: '#/components/schemas/StrategyStatus'
        title:
          $ref: '#/components/schemas/StrategyTitle'
        baseCurrency:
          $ref: '#/components/schemas/Currency'
        riskProfile:
          description: Риск-профиль стратегии
          type: string
          enum: [conservative, moderate, aggressive]
        description:
          description: Описание стратегии
          type: string
          minLength: 1
          example: Пушка
        score:
          description: Оценка стратегии
          type: integer
          minimum: 1
          maximum: 5
        owner:
          $ref: '#/components/schemas/StrategyOwner'
        tests:
          description: Список тестирований, прохождение которых необходимо для следования за стратегией
          type: array
          items:
            $ref: '#/components/schemas/StrategyTest'
        feeRate:
          $ref: '#/components/schemas/StrategyFeeRate'
        load:
          $ref: '#/components/schemas/StrategyLoad'
        expectedRelativeYield:
          description: Ожидаемая относительная доходность стратегии (в процентах)
          type: number
          format: decimal
        shortDescription:
          description: Короткое описание стратегии
          type: string
          minLength: 1
          example: Получение доходности в валюте

    StrategyPreview:
      description: Торговая стратегия
      type: object
      required:
        - id
        - status
        - title
        - owner
        - load
      properties:
        id:
          $ref: '#/components/schemas/StrategyId'
        status:
          $ref: '#/components/schemas/StrategyStatus'
        title:
          $ref: '#/components/schemas/StrategyTitle'
        owner:
          $ref: '#/components/schemas/PreviewStrategyOwner'
        load:
          $ref: '#/components/schemas/StrategyLoad'

    StrategyOwner:
      description: Владелец стратегии
      type: object
      properties:
        socialProfile:
          $ref: '#/components/schemas/MasterSocialProfile'
        description:
          description: Описание владельца
          type: string
          minLength: 1
          example: 15 лет опыта, инвест. советник

    PreviewStrategyOwner:
      description: Владелец стратегии
      type: object
      properties:
        socialProfile:
          $ref: '#/components/schemas/MasterSocialProfile'

    StrategyStatus:
      description: Статус стратегии
      type: string
      enum: [ draft, active ]

    StrategyFeeRate:
      description: Ставка комиссии (в долях) за следование за стратегией
      type: object
      required:
        - management
        - result
      properties:
        management:
          description: Ставка комиссии за управление
          type: number
          format: decimal
          minimum: 0
          maximum: 1
          exclusiveMinimum: true
        result:
          description: Ставка комиссии за результат
          type: number
          format: decimal
          minimum: 0
          maximum: 1
          exclusiveMinimum: true

    GetBlockedContractsResponse:
      type: object
      required:
        - nextCursor
        - hasNext
        - items
      properties:
        nextCursor:
          description: Крайний возвращённый в текущем ответе идентификатор элемента, который необходимо использовать при следующем запросе
          type: string
          minLength: 1
          nullable: true
        hasNext:
          description: Признак наличия элементов, не вошедших в текущий ответ
          type: boolean
        items:
          type: array
          items:
            $ref: '#/components/schemas/BlockedContract'

    BlockedContract:
      description: Заблокированный договор
      type: object
      required:
        - id
        - owner
        - strategy
      properties:
        id:
          $ref: '#/components/schemas/ContractId'
        owner:
          $ref: '#/components/schemas/SlaveClient'
        strategy:
          $ref: '#/components/schemas/SlaveStrategy'

    ContractId:
      description: Номер договора
      type: string
      minLength: 1
      maxLength: 10
      example: 2000000000

    SlaveClient:
      description: Клиент в роли slave
      type: object
      required:
        - id
      properties:
        id:
          $ref: '#/components/schemas/ClientId'

    ClientId:
      description: Единый идентификатор клиента
      type: string
      format: uuid
      example: 397aee00-f163-4eff-a7a6-a4bc11118776

    SlaveStrategy:
      description: Торговая стратегия, к которой подключен договор
      type: object
      required:
        - id
        - title
      properties:
        id:
          $ref: '#/components/schemas/StrategyId'
        title:
          $ref: '#/components/schemas/StrategyTitle'

    StrategyId:
      description: Идентификатор стратегии
      type: string
      format: uuid
      example: 397aee00-f163-4eff-a7a6-a4bc11118776

    StrategyTitle:
      description: Название стратегии
      type: string
      minLength: 1
      example: Ракета

    GetSignalsResponse:
      type: object
      required:
        - nextCursor
        - hasNext
        - items
      properties:
        nextCursor:
          description: Крайний возвращённый в текущем ответе идентификатор элемента, который необходимо использовать при следующем запросе
          type: string
          minLength: 1
          nullable: true
        hasNext:
          description: Признак наличия элементов, не вошедших в текущий ответ
          type: boolean
        items:
          type: array
          items:
            $ref: '#/components/schemas/Signal'

    Signal:
      description: Торговый сигнал
      type: object
      required:
        - createdAt
        - quantity
        - action
        - price
        - exchangePosition
        - version
      properties:
        createdAt:
          description: Дата и время сигнала
          type: string
          format: date-time
        quantity:
          $ref: '#/components/schemas/AssetQuantity'
        action:
          $ref: '#/components/schemas/OrderAction'
        price:
          $ref: '#/components/schemas/Price'
        exchangePosition:
          $ref: '#/components/schemas/SignalExchangePosition'
        version:
          $ref: '#/components/schemas/PortfolioVersion'

    AssetQuantity:
      description: Количество единиц актива (в штуках)
      type: number
      format: decimal

    OrderAction:
      description: Действие, на которое направлена заявка (покупка/продажа)
      type: string
      enum: [buy, sell]

    Price:
      description: Цена
      type: object
      required:
        - value
        - currency
      properties:
        value:
          description: Значение цены за единицу актива
          type: number
          format: decimal
          minimum: 0
          exclusiveMinimum: true
        currency:
          $ref: '#/components/schemas/Currency'

    Currency:
      description: Валюта
      type: string
      enum: [rub, usd]

    SignalExchangePosition:
      description: Биржевая позиция, на изменение которой направлен сигнал
      allOf:
        - $ref: '#/components/schemas/ExchangePositionId'

    StrategyLoad:
      description: Загруженность стратегии
      type: object
      required:
        - isOverloaded
        - percent
      properties:
        isOverloaded:
          description: Признак перегруженности стратегии
          type: boolean
        percent:
          description: Значение загруженности стратегии (в процентах)
          type: number
          format: decimal
          minimum: 0

    GetTimelineRequest:
      type: object
      required:
        - strategyId
      properties:
        strategyId:
          $ref: '#/components/schemas/StrategyId'
        slaveContractId:
          $ref: '#/components/schemas/ContractId'

    GetTimelineResponse:
      type: object
      required:
        - nextCursor
        - hasNext
        - items
      properties:
        nextCursor:
          description: Крайний возвращённый в текущем ответе идентификатор элемента, который необходимо использовать при следующем запросе
          type: string
          minLength: 1
          nullable: true
        hasNext:
          description: Признак наличия элементов, не вошедших в текущий ответ
          type: boolean
        items:
          type: array
          items:
            $ref: '#/components/schemas/TimelineItem'

    TimelineItem:
      description: Элемент ленты событий
      type: object
      required:
        - timestamp
        - content
      properties:
        timestamp:
          description: Метка времени события
          type: string
          format: date-time
        content:
          $ref: '#/components/schemas/TimelineItemContent'

    TimelineItemContent:
      description: Полезное содержимое события
      type: object
      required:
        - domain
      properties:
        domain:
          description: Домен сущности
          type: string
          enum: [master-portfolio, master-signal, slave-portfolio, slave-order]
      discriminator:
        propertyName: domain
        mapping:
          master-portfolio: '#/components/schemas/MasterPortfolioItem'
          master-signal: '#/components/schemas/SignalItem'
          slave-portfolio: '#/components/schemas/SlavePortfolioItem'
          slave-order: '#/components/schemas/SlaveOrderItem'

    MasterPortfolioItem:
      description: Элемент события с типом MasterPortfolio
      allOf:
        - $ref: '#/components/schemas/TimelineItemContent'
        - $ref: '#/components/schemas/MasterPortfolio'

    SignalItem:
      description: Элемент события с типом Signal
      allOf:
        - $ref: '#/components/schemas/TimelineItemContent'
        - $ref: '#/components/schemas/Signal'

    SlavePortfolioItem:
      description: Элемент события с типом SlavePortfolio
      allOf:
        - $ref: '#/components/schemas/TimelineItemContent'
        - $ref: '#/components/schemas/SlavePortfolio'

    SlaveOrderItem:
      description: Элемент события с типом SlaveOrder
      allOf:
        - $ref: '#/components/schemas/TimelineItemContent'
        - $ref: '#/components/schemas/SlaveOrder'

    MasterPortfolio:
      description: Виртуальный портфель ведущего
      type: object
      required:
        - version
        - baseMoneyPosition
        - positions
      properties:
        version:
          $ref: '#/components/schemas/PortfolioVersion'
        baseMoneyPosition:
          $ref: '#/components/schemas/MasterPortfolioBaseMoneyPosition'
        positions:
          description: Позиции виртуального портфеля
          type: array
          items:
            $ref: '#/components/schemas/MasterPortfolioPosition'

    MasterPortfolioBaseMoneyPosition:
      description: Денежная позиция в виртуальном портфеле в базовой валюте
      type: object
      required:
        - quantity
        - lastChange
      properties:
        quantity:
          $ref: '#/components/schemas/AssetQuantity'
        lastChange:
          $ref: '#/components/schemas/MasterPositionLastChange'

    MasterPortfolioPosition:
      description: Позиция в виртуальном портфеле
      type: object
      required:
        - exchangePositionId
        - quantity
        - lastChange
      properties:
        exchangePositionId:
          $ref: '#/components/schemas/ExchangePositionId'
        quantity:
          $ref: '#/components/schemas/AssetQuantity'
        lastChange:
          $ref: '#/components/schemas/MasterPositionLastChange'

    MasterPositionLastChange:
      description: Последнее изменение master-позиции
      type: object
      required:
        - changedAt
      properties:
        changedAt:
          $ref: '#/components/schemas/PositionChangedAt'

    SlavePortfolio:
      description: Портфель ведомого
      type: object
      required:
        - version
        - comparedToMasterVersion
        - baseMoneyPosition
        - positions
      properties:
        version:
          $ref: '#/components/schemas/PortfolioVersion'
        comparedToMasterVersion:
          $ref: '#/components/schemas/PortfolioVersion'
        baseMoneyPosition:
          $ref: '#/components/schemas/SlavePortfolioBaseMoneyPosition'
        positions:
          description: Позиции портфеля
          type: array
          items:
            $ref: '#/components/schemas/SlavePortfolioPosition'

    SlavePortfolioBaseMoneyPosition:
      description: Денежная позиция в портфеле в базовой валюте
      type: object
      required:
        - quantity
      properties:
        quantity:
          $ref: '#/components/schemas/AssetQuantity'
        lastChange:
          $ref: '#/components/schemas/SlavePositionLastChange'

    SlavePortfolioPosition:
      description: Позиция в портфеле
      type: object
      required:
        - exchangePositionId
        - quantity
        - price
        - priceTimestamp
        - rate
        - rateDiff
        - quantityDiff
      properties:
        exchangePositionId:
          $ref: '#/components/schemas/ExchangePositionId'
        quantity:
          $ref: '#/components/schemas/AssetQuantity'
        price:
          $ref: '#/components/schemas/Price'
        priceTimestamp:
          description: Метка времени, на которую была актуальна использованная цена
          type: string
          format: date-time
        rate:
          description: Доля позиции от всего портфеля ведомого
          type: number
          format: decimal
          minimum: 0
          maximum: 1
        rateDiff:
          description: Разница между целевой и фактической долей позиции в портфеле ведомого
          type: number
          format: decimal
          minimum: -1
          maximum: 1
        quantityDiff:
          description: Разница между целевым и фактическим количеством единиц актива (в штуках) в портфеле ведомого
          type: number
          format: decimal
        buyEnabled:
          description: Доступность позиции на покупку
          type: boolean
        sellEnabled:
          description: Доступность позиции на продажу
          type: boolean
        lastChange:
          $ref: '#/components/schemas/SlavePositionLastChange'

    SlavePositionLastChange:
      description: Последнее изменение slave-позиции
      type: object
      required:
        - action
        - changedAt
      properties:
        action:
          $ref: '#/components/schemas/PositionAction'
        changedAt:
          $ref: '#/components/schemas/PositionChangedAt'

    SlaveOrder:
      description: Заявка, выставляемая от лица ведомого
      type: object
      required:
        - version
        - attemptsCount
        - exchangePositionId
        - action
        - quantity
        - filledQuantity
        - price
      properties:
        version:
          $ref: '#/components/schemas/PortfolioVersion'
        attemptsCount:
          description: Номер попытки выставления заявки
          type: integer
          format: int32
        exchangePositionId:
          $ref: '#/components/schemas/ExchangePositionId'
        action:
          $ref: '#/components/schemas/OrderAction'
        quantity:
          $ref: '#/components/schemas/AssetQuantity'
        filledQuantity:
          description: Количество исполненных единиц актива (в штуках)
          type: number
          format: decimal
          minimum: 0
        price:
          $ref: '#/components/schemas/Price'
        state:
          description: Состояние заявки
          type: integer
          format: int32

    PortfolioVersion:
      description: Версия портфеля
      type: integer
      format: int32
      minimum: 0

    PositionChangedAt:
      description: Метка времени последнего изменения позиции
      type: string
      format: date-time

    PositionAction:
      description: Действие, в результате которого была изменена позиция
      type: integer
      format: int32
      minimum: 0

    ErrorResponse:
      description: Ответ с ошибкой
      type: object
      required:
        - errorId
        - errorCode
        - errorMessage
      properties:
        errorId:
          description: Уникальный идентификатор ошибки
          type: string
          minLength: 16
          maxLength: 16
          example: 02d55cabb05b44f0
        errorCode:
          description: Служебный код ошибки
          type: string
          minLength: 1
          maxLength: 12
          example: 0344-01-Z99
        errorMessage:
          description: Служебное описание ошибки
          type: string
          minLength: 1
          example: Сервис временно недоступен
